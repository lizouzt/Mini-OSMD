(function(U,_){typeof exports=="object"&&typeof module<"u"?_(exports,require("vexflow"),require("jszip")):typeof define=="function"&&define.amd?define(["exports","vexflow","jszip"],_):(U=typeof globalThis<"u"?globalThis:U||self,_(U.MiniOSMD={},U.Vex,U.JSZip))})(this,(function(U,_,st){"use strict";function nt(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const n in e)if(n!=="default"){const c=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,c.get?c:{enumerable:!0,get:()=>e[n]})}}return t.default=e,Object.freeze(t)}const a=nt(_);class tt{sourceMeasures=[];slurs=[];ties=[];wedges=[];octaveShifts=[];addMeasure(t){this.sourceMeasures.push(t)}}var Y=(e=>(e[e.Single=0]="Single",e[e.Double=1]="Double",e[e.End=2]="End",e[e.RepeatEnd=3]="RepeatEnd",e[e.RepeatBegin=4]="RepeatBegin",e))(Y||{}),$=(e=>(e[e.None=0]="None",e[e.Start=1]="Start",e[e.Stop=2]="Stop",e[e.StartStop=3]="StartStop",e[e.Discontinue=4]="Discontinue",e))($||{});class ot{constructor(t){this.measureNumber=t}measureNumber;notes=[];clefs=[];keys=[];rhythms=[];endBarType=0;endingType=0;endingNumber="";addNote(t){this.notes.push(t)}}class D{constructor(t=0,n=1){this.numerator=t,this.denominator=n}numerator;denominator;get RealValue(){return this.numerator/this.denominator}static Plus(t,n){return new D(t.numerator*n.denominator+n.numerator*t.denominator,t.denominator*n.denominator).simplify()}simplify(){const t=D.gcd(this.numerator,this.denominator);return this.numerator/=t,this.denominator/=t,this}static gcd(t,n){return n===0?t:D.gcd(n,t%n)}clone(){return new D(this.numerator,this.denominator)}}class rt{pitch;length;durationType;voiceId;staffId;timestamp;slurStarts=[];slurEnds=[];tieStarts=[];tieEnds=[];tuplet;isGrace=!1;articulations=[];lyrics=[];dynamics=[];constructor(t,n,c="quarter",i="1",d=new D(0,1),f=1){this.pitch=t,this.length=n,this.durationType=c,this.voiceId=i,this.timestamp=d,this.staffId=f}}var H=(e=>(e[e.C=0]="C",e[e.D=2]="D",e[e.E=4]="E",e[e.F=5]="F",e[e.G=7]="G",e[e.A=9]="A",e[e.B=11]="B",e))(H||{});class it{constructor(t,n,c){this.step=t,this.octave=n,this.alter=c}step;octave;alter;get Frequency(){const t=this.step+this.alter+(this.octave-4)*12-9;return 440*Math.pow(2,t/12)}}var z=(e=>(e[e.G=0]="G",e[e.F=1]="F",e[e.C=2]="C",e[e.PERCUSSION=3]="PERCUSSION",e[e.TAB=4]="TAB",e))(z||{});class at{constructor(t,n){this.clefType=t,this.line=n}clefType;line}class ct{constructor(t,n){this.key=t,this.mode=n}key;mode}class lt{constructor(t,n){this.numerator=t,this.denominator=n}numerator;denominator}class ut{startNote;endNote}class ht{constructor(t,n){this.actualNotes=t,this.normalNotes=n}actualNotes;normalNotes;notes=[]}class ft{startNote;endNote}var Z=(e=>(e[e.Crescendo=0]="Crescendo",e[e.Diminuendo=1]="Diminuendo",e))(Z||{});class mt{constructor(t){this.type=t}type;startNote;endNote}var J=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e))(J||{});class dt{constructor(t){this.type=t}type;startNote;endNote}class pt{static readMusicXML(t){const c=new DOMParser().parseFromString(t,"text/xml"),i=new tt,d=c.getElementsByTagName("part");let f=0;for(let h=0;h<d.length;h++){const A=d[h].getElementsByTagName("measure");let C=4,k=1;const j={},o={};let u,S,w;for(let T=0;T<A.length;T++){const O=A[T],q=parseInt(O.getAttribute("number")||"0");let x;i.sourceMeasures.length<=T?(x=new ot(q),i.addMeasure(x)):x=i.sourceMeasures[T];let L=new D(0,1);const R=O.getElementsByTagName("attributes")[0];if(R){const p=R.getElementsByTagName("divisions")[0];p&&(C=parseInt(p.textContent||"4"));const N=R.getElementsByTagName("staves")[0];if(N){const r=parseInt(N.textContent||"1");k=Math.max(k,r)}const v=R.getElementsByTagName("clef");for(let r=0;r<v.length;r++){const y=v[r],F=parseInt(y.getAttribute("number")||"1"),E=y.getElementsByTagName("sign")[0]?.textContent,X=parseInt(y.getElementsByTagName("line")[0]?.textContent||"0");let g=z.G;E==="F"&&(g=z.F),E==="C"&&(g=z.C);const P=f+(F-1);x.clefs[P]=new at(g,X)}const B=R.getElementsByTagName("key");for(let r=0;r<B.length;r++){const y=B[r],F=parseInt(y.getAttribute("number")||"1"),E=parseInt(y.getElementsByTagName("fifths")[0]?.textContent||"0"),X=y.getElementsByTagName("mode")[0]?.textContent||"major",g=f+(F-1);x.keys[g]=new ct(E,X)}const V=R.getElementsByTagName("time");for(let r=0;r<V.length;r++){const y=V[r],F=parseInt(y.getAttribute("number")||"1"),E=parseInt(y.getElementsByTagName("beats")[0]?.textContent||"4"),X=parseInt(y.getElementsByTagName("beat-type")[0]?.textContent||"4"),g=f+(F-1);x.rhythms[g]=new lt(E,X)}}const K=O.getElementsByTagName("barline");for(let p=0;p<K.length;p++){const N=K[p],v=N.getAttribute("location"),B=N.getElementsByTagName("ending")[0];if(B){const V=B.getAttribute("number")||"",r=B.getAttribute("type")||"start";x.endingNumber=V,r==="start"?x.endingType=x.endingType===$.Stop?$.StartStop:$.Start:(r==="stop"||r==="discontinue")&&(x.endingType=x.endingType===$.Start?$.StartStop:$.Stop)}if(v==="right"||!v){const V=N.getElementsByTagName("bar-style")[0]?.textContent,r=N.getElementsByTagName("repeat")[0];r&&r.getAttribute("direction")==="backward"?x.endBarType=Y.RepeatEnd:V==="light-heavy"?x.endBarType=Y.End:V==="light-light"&&(x.endBarType=Y.Double)}else if(v==="left"){const V=N.getElementsByTagName("repeat")[0];V&&V.getAttribute("direction")==="forward"&&(x.endBarType=Y.RepeatBegin)}}const s=O.children;let l=new D(0,1),m=[];for(let p=0;p<s.length;p++){const N=s[p];if(N.tagName==="direction"){const v=N.getElementsByTagName("direction-type")[0];if(v){const B=v.getElementsByTagName("dynamics")[0];if(B)for(let y=0;y<B.children.length;y++)m.push(B.children[y].tagName);const V=v.getElementsByTagName("wedge")[0];if(V){const y=V.getAttribute("type");y==="crescendo"||y==="diminuendo"?(u=new mt(y==="crescendo"?Z.Crescendo:Z.Diminuendo),i.wedges.push(u)):y==="stop"&&(u=void 0)}const r=v.getElementsByTagName("octave-shift")[0];if(r){const y=r.getAttribute("type");y==="up"||y==="down"?(S=new dt(y==="up"?J.Up:J.Down),i.octaveShifts.push(S)):y==="stop"&&(S=void 0)}}}else if(N.tagName==="note"){const v=N.getElementsByTagName("chord").length>0,B=N.getElementsByTagName("grace").length>0;let V=v?l.clone():L.clone();v||(l=L.clone());const r=this.parseNote(N,C,V);if(r){r.staffId+=f,r.isGrace=B,m.length>0&&!v&&(r.dynamics.push(...m),m=[]),u&&(u.startNote||(u.startNote=r),u.endNote=r),S&&(S.startNote||(S.startNote=r),S.endNote=r);const y=N.getElementsByTagName("notations")[0];if(y){const E=y.getElementsByTagName("slur");for(let b=0;b<E.length;b++){const G=E[b],W=parseInt(G.getAttribute("number")||"1");if(G.getAttribute("type")==="start"){const I=new ut;I.startNote=r,r.slurStarts.push(I),j[W]=I,i.slurs.push(I)}else{const I=j[W];I&&(I.endNote=r,r.slurEnds.push(I),delete j[W])}}const X=y.getElementsByTagName("tied");for(let b=0;b<X.length;b++){const G=X[b],W=parseInt(G.getAttribute("number")||"1");if(G.getAttribute("type")==="start"){const I=new ft;I.startNote=r,r.tieStarts.push(I),o[W]=I,i.ties.push(I)}else{const I=o[W];I&&(I.endNote=r,r.tieEnds.push(I),delete o[W])}}const g=y.getElementsByTagName("tuplet")[0];if(g){if(g.getAttribute("type")==="start"){const b=N.getElementsByTagName("time-modification")[0];w=new ht(parseInt(b?.getElementsByTagName("actual-notes")[0]?.textContent||"3"),parseInt(b?.getElementsByTagName("normal-notes")[0]?.textContent||"2"))}w&&(r.tuplet=w,w.notes.push(r)),g.getAttribute("type")==="stop"&&(w=void 0)}else w&&(r.tuplet=w,w.notes.push(r));const P=y.getElementsByTagName("articulations")[0];P&&(P.getElementsByTagName("staccato").length>0&&r.articulations.push("staccato"),P.getElementsByTagName("accent").length>0&&r.articulations.push("accent"),P.getElementsByTagName("strong-accent").length>0&&r.articulations.push("marcato"),P.getElementsByTagName("tenuto").length>0&&r.articulations.push("tenuto")),y.getElementsByTagName("fermata").length>0&&r.articulations.push("fermata")}const F=N.getElementsByTagName("lyric");for(let E=0;E<F.length;E++){const X=F[E];r.lyrics.push({text:X.getElementsByTagName("text")[0]?.textContent||"",syllabic:X.getElementsByTagName("syllabic")[0]?.textContent||"single"})}!v&&!B&&(L=D.Plus(L,r.length)),x.addNote(r)}}else if(N.tagName==="backup"){const v=parseInt(N.getElementsByTagName("duration")[0]?.textContent||"0"),B=new D(v,C*4);B.numerator*=-1,L=D.Plus(L,B)}else if(N.tagName==="forward"){const v=parseInt(N.getElementsByTagName("duration")[0]?.textContent||"0");L=D.Plus(L,new D(v,C*4))}}}f+=k}return i}static parseNote(t,n,c){const i=t.getElementsByTagName("pitch")[0];if(!i)return;const d=H[i.getElementsByTagName("step")[0]?.textContent]||H.C,f=parseInt(i.getElementsByTagName("octave")[0]?.textContent||"4"),h=parseInt(i.getElementsByTagName("alter")[0]?.textContent||"0"),M=t.getElementsByTagName("type")[0]?.textContent||"quarter",A=t.getElementsByTagName("voice")[0]?.textContent||"1",C=parseInt(t.getElementsByTagName("staff")[0]?.textContent||"1"),k=parseInt(t.getElementsByTagName("duration")[0]?.textContent||"1");return new rt(new it(d,f,h),new D(k,n*4),M,A,c,C)}}class gt{constructor(t){this.musicSheet=t}musicSheet}class Q{static getKeySignature(t){switch(t){case 0:return"C";case 1:return"G";case 2:return"D";case 3:return"A";case 4:return"E";case 5:return"B";case 6:return"F#";case 7:return"C#";case-1:return"F";case-2:return"Bb";case-3:return"Eb";case-4:return"Ab";case-5:return"Db";case-6:return"Gb";case-7:return"Cb";default:return"C"}}static format(t,n=1e3){const c=[];let i=[],d=0;const f=t.musicSheet,h=new Map,M=["treble","bass"],A=["4/4","4/4"],C=["C","C"];let k=!1;for(const o of f.sourceMeasures){let u=a.Volta.type.NONE;o.endingType===$.Start?(u=a.Volta.type.BEGIN,k=!0):o.endingType===$.Stop?(u=a.Volta.type.END,k=!1):o.endingType===$.StartStop?(u=a.Volta.type.BEGIN_END,k=!1):k&&(u=a.Volta.type.MID),o.clefs.forEach((s,l)=>{if(s)switch(s.clefType){case z.G:M[l]="treble";break;case z.F:M[l]="bass";break;case z.C:M[l]="alto";break;default:M[l]="treble"}}),o.rhythms.forEach((s,l)=>{s&&(A[l]=`${s.numerator}/${s.denominator}`)}),o.keys.forEach((s,l)=>{s&&(C[l]=Q.getKeySignature(s.key))});const S={},w={};let T=0;o.notes.forEach(s=>T=Math.max(T,s.staffId-1)),T=Math.max(T,o.clefs.length-1);for(let s=0;s<=T;s++)S[s]={},w[s]=[];const O={},q={};for(const s of o.notes){const l=s.staffId-1,m=s.voiceId,p=s.timestamp.RealValue;O[l]||(O[l]={},q[l]={}),O[l][m]||(O[l][m]={},q[l][m]=[]),O[l][m][p]||(O[l][m][p]=[],q[l][m].push(p)),O[l][m][p].push(s)}for(let s=0;s<=T;s++){if(!O[s])continue;for(const m in O[s]){S[s][m]=[],q[s][m].sort((N,v)=>N-v);let p=[];for(const N of q[s][m]){const v=O[s][m][N];if(v.length===0)continue;const B=v.filter(g=>!g.isGrace),V=v.filter(g=>g.isGrace);if(B.length===0){p.push(...V);continue}const r=B[0],y=[];for(const g of B){const P=H[g.pitch.step].toLowerCase();y.push(`${P}/${g.pitch.octave}`)}let F="q";switch(r.durationType){case"whole":F="w";break;case"half":F="h";break;case"quarter":F="q";break;case"eighth":F="8";break;case"16th":F="16";break;default:F="q"}const E=new a.StaveNote({clef:M[s]||"treble",keys:y,duration:F});E.sourceNote=r,B.forEach((g,P)=>{if(g.pitch.alter!==0){let b="";g.pitch.alter===1?b="#":g.pitch.alter===-1?b="b":g.pitch.alter===2?b="##":g.pitch.alter===-2&&(b="bb"),b&&E.addModifier(new a.Accidental(b),P)}g.articulations.forEach(b=>{let G="";if(a.Modifier.Position.ABOVE,b==="staccato"?(G="a.",a.Modifier.Position.BELOW):b==="accent"?G="a>":b==="marcato"?G="a^":b==="tenuto"?G="a-":b==="fermata"&&(G="a@a"),G){const W=new a.Articulation(G);E.addModifier(W,P)}}),g.dynamics&&g.dynamics.length>0&&g.dynamics.forEach(b=>{const G=new a.Annotation(b).setFont("Times",12,"italic").setVerticalJustification(a.Annotation.VerticalJustify.BOTTOM);E.addModifier(G,P)})}),r.lyrics&&r.lyrics.length>0&&r.lyrics.forEach(g=>{const P=g.text+(g.syllabic==="begin"||g.syllabic==="middle"?"-":""),b=new a.Annotation(P).setFont("Times",12,"normal").setVerticalJustification(a.Annotation.VerticalJustify.BOTTOM);E.addModifier(b,0)});const X=[...p,...V];if(X.length>0){const g=X.map(b=>{const G=H[b.pitch.step].toLowerCase(),W=new a.GraceNote({keys:[`${G}/${b.pitch.octave}`],duration:"8",slash:!0});if(b.pitch.alter!==0){let I="";b.pitch.alter===1?I="#":b.pitch.alter===-1&&(I="b"),I&&W.addModifier(new a.Accidental(I),0)}return W}),P=new a.GraceNoteGroup(g);E.addModifier(P,0),p=[]}m==="1"?E.setStemDirection(a.Stem.UP):E.setStemDirection(a.Stem.DOWN),S[s][m].push(E);for(const g of v)h.set(g,E)}}const l=new Set;for(const m of o.notes)if(m.staffId-1===s&&m.tuplet&&!l.has(m.tuplet)){const p=m.tuplet,N=p.notes.map(v=>h.get(v)).filter((v,B,V)=>v&&V.indexOf(v)===B);if(N.length>0){const v=new a.Tuplet(N,{numNotes:p.actualNotes,notesOccupied:p.normalNotes});w[s].push(v)}l.add(p)}}let x=150;for(let s=0;s<=T;s++){const l=[];for(const m in S[s]){const p=new a.Voice({numBeats:4,beatValue:4});p.addTickables(S[s][m]),l.push(p)}if(l.length>0)try{const p=new a.Formatter().joinVoices(l).preCalculateMinTotalWidth(l);let N=20;(o.clefs[s]||o.measureNumber===1)&&(N+=40),(o.rhythms[s]||o.measureNumber===1)&&(N+=30),o.keys[s]&&(N+=20),x=Math.max(x,p+N)}catch{}}const L=[];for(let s=0;s<=T;s++){const l=[];for(const m in S[s]){const p=a.Beam.generateBeams(S[s][m]);l.push(...p)}L.push({vfVoices:S[s],beams:l,vfTuplets:w[s],clef:o.clefs[s]?M[s]:void 0,keySignature:o.keys[s]||o.measureNumber===1?C[s]:void 0,timeSignature:o.rhythms[s]?A[s]:void 0,voltaType:s===0?u:a.Volta.type.NONE,voltaNumber:s===0?o.endingNumber:""})}let R;if(o.endBarType!==void 0)switch(o.endBarType){case Y.Single:R=a.Barline.type.SINGLE;break;case Y.Double:R=a.Barline.type.DOUBLE;break;case Y.End:R=a.Barline.type.END;break;case Y.RepeatEnd:R=a.Barline.type.REPEAT_END;break;case Y.RepeatBegin:R=a.Barline.type.REPEAT_BEGIN;break;default:R=a.Barline.type.SINGLE}const K={measureNumber:o.measureNumber,staves:L,width:x,endBarLineType:R};if(d+K.width>n&&i.length>0){const l=(n-d)/i.length;i.forEach(m=>m.width+=l),c.push(i),i=[],d=0}i.push(K),d+=K.width}i.length>0&&c.push(i);const j=[];for(const o of f.slurs)if(o.startNote&&o.endNote){const u=h.get(o.startNote),S=h.get(o.endNote);if(u&&S){const w=new a.Curve(u,S,{thickness:2,xShift:0,yShift:10});j.push(w)}}for(const o of f.ties)if(o.startNote&&o.endNote){const u=h.get(o.startNote),S=h.get(o.endNote);if(u&&S){const w=new a.StaveTie({firstNote:u,lastNote:S,firstIndexes:[0],lastIndexes:[0]});j.push(w)}}for(const o of f.wedges)if(o.startNote&&o.endNote){const u=h.get(o.startNote),S=h.get(o.endNote);if(u&&S){const w=new a.StaveHairpin({firstNote:u,lastNote:S},o.type===Z.Crescendo?a.StaveHairpin.type.CRESC:a.StaveHairpin.type.DECRESC);w.setPosition(a.Modifier.Position.BELOW),j.push(w)}}for(const o of f.octaveShifts)if(o.startNote&&o.endNote){const u=h.get(o.startNote),S=h.get(o.endNote);if(u&&S){const w=o.type===J.Up?"8va":"8vb",T=o.type===J.Up?a.TextBracket.Position.TOP:a.TextBracket.Position.BOTTOM,O=new a.TextBracket({start:u,stop:S,text:w,position:T});j.push(O)}}return{systems:c,curves:j}}}class et{constructor(t){this.container=t,this.renderer=new a.Renderer(t,a.Renderer.Backends.SVG),this.ctx=this.renderer.getContext()}container;renderer;ctx;draw(t){const{systems:n,curves:c}=t;this.ctx.clear();const i=10;let d=i,f=50;const h=new Map;for(const M of n){const A=this.calculateSystemLayout(M);let C=0;d=i;for(const k of M){const j=k.staves,o=[];if(j.forEach((u,S)=>{const w=f+A[S],T=new a.Stave(d,w,k.width);if((u.clef||d===i)&&T.addClef(u.clef||"treble"),u.keySignature&&T.addKeySignature(u.keySignature),u.timeSignature&&T.addTimeSignature(u.timeSignature),k.endBarLineType!==void 0&&T.setEndBarType(k.endBarLineType),u.voltaType!==void 0&&u.voltaType!==a.Volta.type.NONE&&T.setVoltaType(u.voltaType,u.voltaNumber||"1",0),T.setContext(this.ctx).draw(),o.push(T),Object.keys(u.vfVoices||{}).length>0){const{voices:q,allNotes:x}=this.createVoices(u);new a.Formatter().joinVoices(q).format(q,k.width-50),q.forEach(l=>l.draw(this.ctx,T));const L=T.getYForTopText(0)||w,K=(T.getYForBottomText(0)||w+100)-L;x.forEach(l=>{if(l.sourceNote){const m=l.sourceNote.timestamp.RealValue,p=l.getBoundingBox();p&&(h.has(m)||h.set(m,[]),h.get(m).push({x:p.getX(),y:L,height:K}))}}),u.beams&&u.beams.forEach(l=>l.setContext(this.ctx).draw()),u.vfTuplets&&u.vfTuplets.forEach(l=>l.setContext(this.ctx).draw());let s=w+100;x.forEach(l=>{const m=l.getBoundingBox();m&&(s=Math.max(s,m.getY()+m.getH())),l.getModifiers().forEach(p=>{p.text_line&&(s=Math.max(s,w+140))})}),C=Math.max(C,s)}else C=Math.max(C,w+100)}),o.length>1&&d===i){const u=new a.StaveConnector(o[0],o[o.length-1]);u.setType(a.StaveConnector.type.BRACE),u.setContext(this.ctx).draw();const S=new a.StaveConnector(o[0],o[o.length-1]);S.setType(a.StaveConnector.type.SINGLE_LEFT),S.setContext(this.ctx).draw()}d+=k.width}f=C+60}return c&&c.forEach(M=>M.setContext(this.ctx).draw()),this.renderer.resize&&this.renderer.resize(this.container.clientWidth,f+100),h}calculateSystemLayout(t){if(t.length===0)return[];const n=t[0].staves.length,c=[0];let i=0;for(let d=0;d<n-1;d++){let f=100;for(const h of t){const M=h.staves[d],A=h.staves[d+1],C=this.measureStaffBottom(M,h.width),k=this.measureStaffTop(A,h.width),o=C-k+40;f=Math.max(f,o)}i+=f,c.push(i)}return c}measureStaffBottom(t,n){let c=80;if(Object.keys(t.vfVoices||{}).length===0)return c;const{voices:d,allNotes:f}=this.createVoices(t);return new a.Stave(0,0,n),new a.Formatter().joinVoices(d).format(d,n-50),f.forEach(h=>{h.keys.forEach((A,C)=>{const j=h.getKeyProps()[C].line*10;c=Math.max(c,j+20)}),h.modifiers.some(A=>A.category==="annotation")&&(c+=30)}),c}measureStaffTop(t,n){let c=0;const i=Object.keys(t.vfVoices||{});if(i.length===0)return c;const d=[];for(const f of i)d.push(...t.vfVoices[f]);return d.forEach(f=>{f.keys.forEach((h,M)=>{const C=f.getKeyProps()[M].line*10;c=Math.min(c,C-20)})}),c}createVoices(t){let n=4,c=4;if(t.timeSignature){const h=t.timeSignature.split("/");n=parseInt(h[0]),c=parseInt(h[1])}const i=[];let d=[];const f=Object.keys(t.vfVoices||{});for(const h of f){const M=t.vfVoices[h],A=new a.Voice({numBeats:n,beatValue:c});A.setStrict(!1),A.addTickables(M),i.push(A),d.push(...M)}return{voices:i,allNotes:d}}}class yt{static async MXLtoXML(t){const n=new st;try{const c=await n.loadAsync(t),i=Object.keys(c.files);let d="META-INF/container.xml",f=i.find(h=>h.endsWith(".xml")&&!h.includes("container.xml")&&!h.startsWith("__MACOSX"));if(f||(f=i.find(h=>h.endsWith(".musicxml")&&!h.startsWith("__MACOSX"))),f)return await c.file(f)?.async("string")||"";throw new Error("No MusicXML file found in MXL.")}catch(c){throw console.error(c),new Error("Failed to parse MXL file.")}}}class Nt{constructor(t){this.container=t,getComputedStyle(this.container).position==="static"&&(this.container.style.position="relative"),this.cursorElement=document.createElement("div"),this.cursorElement.style.position="absolute",this.cursorElement.style.zIndex="1000",this.cursorElement.style.backgroundColor="rgba(255, 0, 0, 0.5)",this.cursorElement.style.width="4px",this.cursorElement.style.pointerEvents="none",this.cursorElement.style.display="none",this.container.appendChild(this.cursorElement)}container;cursorElement;timestampMap=new Map;timestamps=[];currentIndex=0;init(t){this.timestampMap=t,this.timestamps=Array.from(t.keys()).sort((n,c)=>n-c),this.currentIndex=0,this.hide()}show(){this.cursorElement.style.display="block",this.update()}hide(){this.cursorElement.style.display="none"}next(){this.currentIndex<this.timestamps.length-1&&(this.currentIndex++,this.update())}prev(){this.currentIndex>0&&(this.currentIndex--,this.update())}reset(){this.currentIndex=0,this.update()}update(){if(this.timestamps.length===0)return;const t=this.timestamps[this.currentIndex],n=this.timestampMap.get(t);if(n&&n.length>0){let c=n[0].y,i=n[0].y+n[0].height,d=n[0].x;n.forEach(f=>{c=Math.min(c,f.y),i=Math.max(i,f.y+f.height),d=Math.min(d,f.x)}),this.cursorElement.style.left=`${d}px`,this.cursorElement.style.top=`${c}px`,this.cursorElement.style.height=`${i-c}px`}}}class vt{constructor(t){if(typeof t=="string"){const n=document.getElementById(t);if(!n)throw new Error("Container element not found");this.container=n}else this.container=t;this.drawer=new et(this.container),this.cursor=new Nt(this.container)}container;drawer;sheet;graphicalSheet;cursor;async load(t){return new Promise(async(n,c)=>{try{let i="";typeof t=="string"?(t.startsWith("PK"),i=t):i=await yt.MXLtoXML(t),this.sheet=pt.readMusicXML(i),n()}catch(i){c(i)}})}render(){if(!this.sheet){console.warn("No sheet loaded. Call load() first.");return}this.graphicalSheet=new gt(this.sheet);const t=this.container.clientWidth||1e3,n=Q.format(this.graphicalSheet,t),c=this.drawer.draw(n);this.cursor.init(c),this.cursor.show()}}U.MusicSheet=tt,U.OpenSheetMusicDisplay=vt,U.VexFlowMusicSheetDrawer=et,Object.defineProperty(U,Symbol.toStringTag,{value:"Module"})}));

(function(q,H){typeof exports=="object"&&typeof module<"u"?H(exports,require("vexflow"),require("jszip")):typeof define=="function"&&define.amd?define(["exports","vexflow","jszip"],H):(q=typeof globalThis<"u"?globalThis:q||self,H(q.MiniOSMD={},q.Vex,q.JSZip))})(this,(function(q,H,nt){"use strict";function ot(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const o in e)if(o!=="default"){const a=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,a.get?a:{enumerable:!0,get:()=>e[o]})}}return t.default=e,Object.freeze(t)}const r=ot(H);class tt{sourceMeasures=[];slurs=[];ties=[];wedges=[];octaveShifts=[];addMeasure(t){this.sourceMeasures.push(t)}}var U=(e=>(e[e.Single=0]="Single",e[e.Double=1]="Double",e[e.End=2]="End",e[e.RepeatEnd=3]="RepeatEnd",e[e.RepeatBegin=4]="RepeatBegin",e))(U||{}),Y=(e=>(e[e.None=0]="None",e[e.Start=1]="Start",e[e.Stop=2]="Stop",e[e.StartStop=3]="StartStop",e[e.Discontinue=4]="Discontinue",e))(Y||{});class it{constructor(t){this.measureNumber=t}measureNumber;notes=[];clefs=[];keys=[];rhythms=[];endBarType=0;endingType=0;endingNumber="";addNote(t){this.notes.push(t)}}class L{constructor(t=0,o=1){this.numerator=t,this.denominator=o}numerator;denominator;get RealValue(){return this.numerator/this.denominator}static Plus(t,o){return new L(t.numerator*o.denominator+o.numerator*t.denominator,t.denominator*o.denominator).simplify()}simplify(){const t=L.gcd(this.numerator,this.denominator);return this.numerator/=t,this.denominator/=t,this}static gcd(t,o){return o===0?t:L.gcd(o,t%o)}clone(){return new L(this.numerator,this.denominator)}}class rt{pitch;length;durationType;voiceId;staffId;timestamp;slurStarts=[];slurEnds=[];tieStarts=[];tieEnds=[];tuplet;isGrace=!1;isRest=!1;articulations=[];lyrics=[];dynamics=[];constructor(t,o,a="quarter",c="1",d=new L(0,1),f=1){this.pitch=t,this.length=o,this.durationType=a,this.voiceId=c,this.timestamp=d,this.staffId=f}}var _=(e=>(e[e.C=0]="C",e[e.D=2]="D",e[e.E=4]="E",e[e.F=5]="F",e[e.G=7]="G",e[e.A=9]="A",e[e.B=11]="B",e))(_||{});class et{constructor(t,o,a){this.step=t,this.octave=o,this.alter=a}step;octave;alter;get Frequency(){const t=this.step+this.alter+(this.octave-4)*12-9;return 440*Math.pow(2,t/12)}}var z=(e=>(e[e.G=0]="G",e[e.F=1]="F",e[e.C=2]="C",e[e.PERCUSSION=3]="PERCUSSION",e[e.TAB=4]="TAB",e))(z||{});class at{constructor(t,o){this.clefType=t,this.line=o}clefType;line}class ct{constructor(t,o){this.key=t,this.mode=o}key;mode}class lt{constructor(t,o){this.numerator=t,this.denominator=o}numerator;denominator}class ut{startNote;endNote}class ht{constructor(t,o){this.actualNotes=t,this.normalNotes=o}actualNotes;normalNotes;notes=[]}class ft{startNote;endNote}var Z=(e=>(e[e.Crescendo=0]="Crescendo",e[e.Diminuendo=1]="Diminuendo",e))(Z||{});class mt{constructor(t){this.type=t}type;startNote;endNote}var J=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e))(J||{});class dt{constructor(t){this.type=t}type;startNote;endNote}class pt{static readMusicXML(t){const a=new DOMParser().parseFromString(t,"text/xml"),c=new tt,d=a.getElementsByTagName("part");let f=0;for(let h=0;h<d.length;h++){const I=d[h].getElementsByTagName("measure");let B=4,V=1;const P={},n={};let u,N,E,w=new L(0,1);for(let O=0;O<I.length;O++){const j=I[O],$=parseInt(j.getAttribute("number")||"0");let C;c.sourceMeasures.length<=O?(C=new it($),c.addMeasure(C)):C=c.sourceMeasures[O];const D=j.getElementsByTagName("attributes")[0];if(D){const p=D.getElementsByTagName("divisions")[0];p&&(B=parseInt(p.textContent||"4"));const v=D.getElementsByTagName("staves")[0];if(v){const i=parseInt(v.textContent||"1");V=Math.max(V,i)}const S=D.getElementsByTagName("clef");for(let i=0;i<S.length;i++){const g=S[i],R=parseInt(g.getAttribute("number")||"1"),T=g.getElementsByTagName("sign")[0]?.textContent,X=parseInt(g.getElementsByTagName("line")[0]?.textContent||"0");let y=z.G;T==="F"&&(y=z.F),T==="C"&&(y=z.C);const G=f+(R-1);C.clefs[G]=new at(y,X)}const x=D.getElementsByTagName("key");for(let i=0;i<x.length;i++){const g=x[i],R=parseInt(g.getAttribute("number")||"1"),T=parseInt(g.getElementsByTagName("fifths")[0]?.textContent||"0"),X=g.getElementsByTagName("mode")[0]?.textContent||"major",y=f+(R-1);C.keys[y]=new ct(T,X)}const A=D.getElementsByTagName("time");for(let i=0;i<A.length;i++){const g=A[i],R=parseInt(g.getAttribute("number")||"1"),T=parseInt(g.getElementsByTagName("beats")[0]?.textContent||"4"),X=parseInt(g.getElementsByTagName("beat-type")[0]?.textContent||"4"),y=f+(R-1);C.rhythms[y]=new lt(T,X)}}const K=j.getElementsByTagName("barline");for(let p=0;p<K.length;p++){const v=K[p],S=v.getAttribute("location"),x=v.getElementsByTagName("ending")[0];if(x){const A=x.getAttribute("number")||"",i=x.getAttribute("type")||"start";C.endingNumber=A,i==="start"?C.endingType=C.endingType===Y.Stop?Y.StartStop:Y.Start:(i==="stop"||i==="discontinue")&&(C.endingType=C.endingType===Y.Start?Y.StartStop:Y.Stop)}if(S==="right"||!S){const A=v.getElementsByTagName("bar-style")[0]?.textContent,i=v.getElementsByTagName("repeat")[0];i&&i.getAttribute("direction")==="backward"?C.endBarType=U.RepeatEnd:A==="light-heavy"?C.endBarType=U.End:A==="light-light"&&(C.endBarType=U.Double)}else if(S==="left"){const A=v.getElementsByTagName("repeat")[0];A&&A.getAttribute("direction")==="forward"&&(C.endBarType=U.RepeatBegin)}}const s=j.children;let l=new L(0,1),m=[];for(let p=0;p<s.length;p++){const v=s[p];if(v.tagName==="direction"){const S=v.getElementsByTagName("direction-type")[0];if(S){const x=S.getElementsByTagName("dynamics")[0];if(x)for(let g=0;g<x.children.length;g++)m.push(x.children[g].tagName);const A=S.getElementsByTagName("wedge")[0];if(A){const g=A.getAttribute("type");g==="crescendo"||g==="diminuendo"?(u=new mt(g==="crescendo"?Z.Crescendo:Z.Diminuendo),c.wedges.push(u)):g==="stop"&&(u=void 0)}const i=S.getElementsByTagName("octave-shift")[0];if(i){const g=i.getAttribute("type");g==="up"||g==="down"?(N=new dt(g==="up"?J.Up:J.Down),c.octaveShifts.push(N)):g==="stop"&&(N=void 0)}}}else if(v.tagName==="note"){const S=v.getElementsByTagName("chord").length>0,x=v.getElementsByTagName("grace").length>0;let A=S?l.clone():w.clone();S||(l=w.clone());const i=this.parseNote(v,B,A);if(i){i.staffId+=f,i.isGrace=x,m.length>0&&!S&&(i.dynamics.push(...m),m=[]),u&&(u.startNote||(u.startNote=i),u.endNote=i),N&&(N.startNote||(N.startNote=i),N.endNote=i);const g=v.getElementsByTagName("notations")[0];if(g){const T=g.getElementsByTagName("slur");for(let b=0;b<T.length;b++){const F=T[b],W=parseInt(F.getAttribute("number")||"1");if(F.getAttribute("type")==="start"){const k=new ut;k.startNote=i,i.slurStarts.push(k),P[W]=k,c.slurs.push(k)}else{const k=P[W];k&&(k.endNote=i,i.slurEnds.push(k),delete P[W])}}const X=g.getElementsByTagName("tied");for(let b=0;b<X.length;b++){const F=X[b],W=parseInt(F.getAttribute("number")||"1");if(F.getAttribute("type")==="start"){const k=new ft;k.startNote=i,i.tieStarts.push(k),n[W]=k,c.ties.push(k)}else{const k=n[W];k&&(k.endNote=i,i.tieEnds.push(k),delete n[W])}}const y=g.getElementsByTagName("tuplet")[0];if(y){if(y.getAttribute("type")==="start"){const b=v.getElementsByTagName("time-modification")[0];E=new ht(parseInt(b?.getElementsByTagName("actual-notes")[0]?.textContent||"3"),parseInt(b?.getElementsByTagName("normal-notes")[0]?.textContent||"2"))}E&&(i.tuplet=E,E.notes.push(i)),y.getAttribute("type")==="stop"&&(E=void 0)}else E&&(i.tuplet=E,E.notes.push(i));const G=g.getElementsByTagName("articulations")[0];G&&(G.getElementsByTagName("staccato").length>0&&i.articulations.push("staccato"),G.getElementsByTagName("accent").length>0&&i.articulations.push("accent"),G.getElementsByTagName("strong-accent").length>0&&i.articulations.push("marcato"),G.getElementsByTagName("tenuto").length>0&&i.articulations.push("tenuto")),g.getElementsByTagName("fermata").length>0&&i.articulations.push("fermata")}const R=v.getElementsByTagName("lyric");for(let T=0;T<R.length;T++){const X=R[T];i.lyrics.push({text:X.getElementsByTagName("text")[0]?.textContent||"",syllabic:X.getElementsByTagName("syllabic")[0]?.textContent||"single"})}!S&&!x&&(w=L.Plus(w,i.length)),C.addNote(i)}}else if(v.tagName==="backup"){const S=parseInt(v.getElementsByTagName("duration")[0]?.textContent||"0"),x=new L(S,B*4);x.numerator*=-1,w=L.Plus(w,x)}else if(v.tagName==="forward"){const S=parseInt(v.getElementsByTagName("duration")[0]?.textContent||"0");w=L.Plus(w,new L(S,B*4))}}}f+=V}return c}static parseNote(t,o,a){const c=t.getElementsByTagName("type")[0]?.textContent||"quarter",d=t.getElementsByTagName("voice")[0]?.textContent||"1",f=parseInt(t.getElementsByTagName("staff")[0]?.textContent||"1"),h=parseInt(t.getElementsByTagName("duration")[0]?.textContent||"1"),M=t.getElementsByTagName("rest")[0],I=t.getElementsByTagName("pitch")[0];let B,V=!1;if(M)V=!0,B=new et(_.B,4,0);else if(I){const n=_[I.getElementsByTagName("step")[0]?.textContent]||_.C,u=parseInt(I.getElementsByTagName("octave")[0]?.textContent||"4"),N=parseInt(I.getElementsByTagName("alter")[0]?.textContent||"0");B=new et(n,u,N)}else return;const P=new rt(B,new L(h,o*4),c,d,a,f);return P.isRest=V,P}}class gt{constructor(t){this.musicSheet=t}musicSheet}class Q{static getKeySignature(t){switch(t){case 0:return"C";case 1:return"G";case 2:return"D";case 3:return"A";case 4:return"E";case 5:return"B";case 6:return"F#";case 7:return"C#";case-1:return"F";case-2:return"Bb";case-3:return"Eb";case-4:return"Ab";case-5:return"Db";case-6:return"Gb";case-7:return"Cb";default:return"C"}}static format(t,o=1e3){const a=[];let c=[],d=0;const f=t.musicSheet,h=new Map,M=["treble","bass"],I=["4/4","4/4"],B=["C","C"];let V=!1;for(const n of f.sourceMeasures){let u=r.Volta.type.NONE;n.endingType===Y.Start?(u=r.Volta.type.BEGIN,V=!0):n.endingType===Y.Stop?(u=r.Volta.type.END,V=!1):n.endingType===Y.StartStop?(u=r.Volta.type.BEGIN_END,V=!1):V&&(u=r.Volta.type.MID),n.clefs.forEach((s,l)=>{if(s)switch(s.clefType){case z.G:M[l]="treble";break;case z.F:M[l]="bass";break;case z.C:M[l]="alto";break;default:M[l]="treble"}}),n.rhythms.forEach((s,l)=>{s&&(I[l]=`${s.numerator}/${s.denominator}`)}),n.keys.forEach((s,l)=>{s&&(B[l]=Q.getKeySignature(s.key))});const N={},E={};let w=0;n.notes.forEach(s=>w=Math.max(w,s.staffId-1)),w=Math.max(w,n.clefs.length-1);for(let s=0;s<=w;s++)N[s]={},E[s]=[];const O={},j={};for(const s of n.notes){const l=s.staffId-1,m=s.voiceId,p=s.timestamp.RealValue;O[l]||(O[l]={},j[l]={}),O[l][m]||(O[l][m]={},j[l][m]=[]),O[l][m][p]||(O[l][m][p]=[],j[l][m].push(p)),O[l][m][p].push(s)}for(let s=0;s<=w;s++){if(!O[s])continue;for(const m in O[s]){N[s][m]=[],j[s][m].sort((v,S)=>v-S);let p=[];for(const v of j[s][m]){const S=O[s][m][v];if(S.length===0)continue;const x=S.filter(y=>!y.isGrace),A=S.filter(y=>y.isGrace);if(x.length===0){p.push(...A);continue}const i=x[0],g=[];if(i.isRest)g.push("b/4");else for(const y of x){const G=_[y.pitch.step].toLowerCase();g.push(`${G}/${y.pitch.octave}`)}let R="q";switch(i.durationType){case"whole":R="w";break;case"half":R="h";break;case"quarter":R="q";break;case"eighth":R="8";break;case"16th":R="16";break;default:R="q"}i.isRest&&(R+="r");const T=new r.StaveNote({clef:M[s]||"treble",keys:g,duration:R});T.sourceNote=i,x.forEach((y,G)=>{if(y.pitch.alter!==0){let b="";y.pitch.alter===1?b="#":y.pitch.alter===-1?b="b":y.pitch.alter===2?b="##":y.pitch.alter===-2&&(b="bb"),b&&T.addModifier(new r.Accidental(b),G)}y.articulations.forEach(b=>{let F="";if(r.Modifier.Position.ABOVE,b==="staccato"?(F="a.",r.Modifier.Position.BELOW):b==="accent"?F="a>":b==="marcato"?F="a^":b==="tenuto"?F="a-":b==="fermata"&&(F="a@a"),F){const W=new r.Articulation(F);T.addModifier(W,G)}}),y.dynamics&&y.dynamics.length>0&&y.dynamics.forEach(b=>{const F=new r.Annotation(b).setFont("Times",12,"italic").setVerticalJustification(r.Annotation.VerticalJustify.BOTTOM);T.addModifier(F,G)})}),i.lyrics&&i.lyrics.length>0&&i.lyrics.forEach(y=>{const G=y.text+(y.syllabic==="begin"||y.syllabic==="middle"?"-":""),b=new r.Annotation(G).setFont("Times",12,"normal").setVerticalJustification(r.Annotation.VerticalJustify.BOTTOM);T.addModifier(b,0)});const X=[...p,...A];if(X.length>0){const y=X.map(b=>{const F=_[b.pitch.step].toLowerCase(),W=new r.GraceNote({keys:[`${F}/${b.pitch.octave}`],duration:"8",slash:!0});if(b.pitch.alter!==0){let k="";b.pitch.alter===1?k="#":b.pitch.alter===-1&&(k="b"),k&&W.addModifier(new r.Accidental(k),0)}return W}),G=new r.GraceNoteGroup(y);T.addModifier(G,0),p=[]}m==="1"?T.setStemDirection(r.Stem.UP):T.setStemDirection(r.Stem.DOWN),N[s][m].push(T);for(const y of S)h.set(y,T)}}const l=new Set;for(const m of n.notes)if(m.staffId-1===s&&m.tuplet&&!l.has(m.tuplet)){const p=m.tuplet,v=p.notes.map(S=>h.get(S)).filter((S,x,A)=>S&&A.indexOf(S)===x);if(v.length>0){const S=new r.Tuplet(v,{numNotes:p.actualNotes,notesOccupied:p.normalNotes});E[s].push(S)}l.add(p)}}let $=150;for(let s=0;s<=w;s++){const l=[];for(const m in N[s]){const p=new r.Voice({numBeats:4,beatValue:4});p.addTickables(N[s][m]),l.push(p)}if(l.length>0)try{const p=new r.Formatter().joinVoices(l).preCalculateMinTotalWidth(l);let v=20;(n.clefs[s]||n.measureNumber===1)&&(v+=40),(n.rhythms[s]||n.measureNumber===1)&&(v+=30),n.keys[s]&&(v+=20),$=Math.max($,p+v)}catch{}}const C=[];for(let s=0;s<=w;s++){const l=[];for(const m in N[s]){const p=r.Beam.generateBeams(N[s][m]);l.push(...p)}C.push({vfVoices:N[s],beams:l,vfTuplets:E[s],clef:n.clefs[s]?M[s]:void 0,keySignature:n.keys[s]||n.measureNumber===1?B[s]:void 0,timeSignature:n.rhythms[s]?I[s]:void 0,voltaType:s===0?u:r.Volta.type.NONE,voltaNumber:s===0?n.endingNumber:""})}let D;if(n.endBarType!==void 0)switch(n.endBarType){case U.Single:D=r.Barline.type.SINGLE;break;case U.Double:D=r.Barline.type.DOUBLE;break;case U.End:D=r.Barline.type.END;break;case U.RepeatEnd:D=r.Barline.type.REPEAT_END;break;case U.RepeatBegin:D=r.Barline.type.REPEAT_BEGIN;break;default:D=r.Barline.type.SINGLE}const K={measureNumber:n.measureNumber,staves:C,width:$,endBarLineType:D};if(d+K.width>o&&c.length>0){const l=(o-d)/c.length;c.forEach(m=>m.width+=l),a.push(c),c=[],d=0}c.push(K),d+=K.width}c.length>0&&a.push(c);const P=[];for(const n of f.slurs)if(n.startNote&&n.endNote){const u=h.get(n.startNote),N=h.get(n.endNote);if(u&&N){const E=new r.Curve(u,N,{thickness:2,xShift:0,yShift:10});P.push(E)}}for(const n of f.ties)if(n.startNote&&n.endNote){const u=h.get(n.startNote),N=h.get(n.endNote);if(u&&N){const E=new r.StaveTie({firstNote:u,lastNote:N,firstIndexes:[0],lastIndexes:[0]});P.push(E)}}for(const n of f.wedges)if(n.startNote&&n.endNote){const u=h.get(n.startNote),N=h.get(n.endNote);if(u&&N){const E=new r.StaveHairpin({firstNote:u,lastNote:N},n.type===Z.Crescendo?r.StaveHairpin.type.CRESC:r.StaveHairpin.type.DECRESC);E.setPosition(r.Modifier.Position.BELOW),P.push(E)}}for(const n of f.octaveShifts)if(n.startNote&&n.endNote){const u=h.get(n.startNote),N=h.get(n.endNote);if(u&&N){const E=n.type===J.Up?"8va":"8vb",w=n.type===J.Up?r.TextBracket.Position.TOP:r.TextBracket.Position.BOTTOM,O=new r.TextBracket({start:u,stop:N,text:E,position:w});P.push(O)}}return{systems:a,curves:P}}}class st{constructor(t){this.container=t,this.renderer=new r.Renderer(t,r.Renderer.Backends.SVG),this.ctx=this.renderer.getContext()}container;renderer;ctx;draw(t){const{systems:o,curves:a}=t;this.ctx.clear();const c=10;let d=c,f=50;const h=new Map;for(const M of o){const I=this.calculateSystemLayout(M);let B=0;d=c;for(const V of M){const P=V.staves,n=[];if(P.forEach((u,N)=>{const E=f+I[N],w=new r.Stave(d,E,V.width);if((u.clef||d===c)&&w.addClef(u.clef||"treble"),u.keySignature&&w.addKeySignature(u.keySignature),u.timeSignature&&w.addTimeSignature(u.timeSignature),V.endBarLineType!==void 0&&w.setEndBarType(V.endBarLineType),u.voltaType!==void 0&&u.voltaType!==r.Volta.type.NONE&&w.setVoltaType(u.voltaType,u.voltaNumber||"1",0),w.setContext(this.ctx).draw(),n.push(w),Object.keys(u.vfVoices||{}).length>0){const{voices:j,allNotes:$}=this.createVoices(u);new r.Formatter().joinVoices(j).format(j,V.width-50),j.forEach(l=>l.draw(this.ctx,w));const C=w.getYForLine(0),K=w.getYForLine(4)-C;$.forEach(l=>{if(l.sourceNote){const m=l.sourceNote.timestamp.RealValue,p=l.getBoundingBox();p&&(h.has(m)||h.set(m,[]),h.get(m).push({x:p.getX(),y:C,height:K}))}}),u.beams&&u.beams.forEach(l=>l.setContext(this.ctx).draw()),u.vfTuplets&&u.vfTuplets.forEach(l=>l.setContext(this.ctx).draw());let s=E+100;$.forEach(l=>{const m=l.getBoundingBox();m&&(s=Math.max(s,m.getY()+m.getH())),l.getModifiers().forEach(p=>{p.text_line&&(s=Math.max(s,E+140))})}),B=Math.max(B,s)}else B=Math.max(B,E+100)}),n.length>1&&d===c){const u=new r.StaveConnector(n[0],n[n.length-1]);u.setType(r.StaveConnector.type.BRACE),u.setContext(this.ctx).draw();const N=new r.StaveConnector(n[0],n[n.length-1]);N.setType(r.StaveConnector.type.SINGLE_LEFT),N.setContext(this.ctx).draw()}d+=V.width}f=B+60}return a&&a.forEach(M=>M.setContext(this.ctx).draw()),this.renderer.resize&&this.renderer.resize(this.container.clientWidth,f+100),h}calculateSystemLayout(t){if(t.length===0)return[];const o=t[0].staves.length,a=[0];let c=0;for(let d=0;d<o-1;d++){let f=80;for(const h of t){const M=h.staves[d],I=h.staves[d+1],B=this.measureStaffBottom(M,h.width),V=this.measureStaffTop(I,h.width),n=B-V+10;f=Math.max(f,n)}c+=f,a.push(c)}return a}measureStaffBottom(t,o){let a=80;if(Object.keys(t.vfVoices||{}).length===0)return a;const{voices:d,allNotes:f}=this.createVoices(t);return new r.Stave(0,0,o),new r.Formatter().joinVoices(d).format(d,o-50),f.forEach(h=>{h.keys.forEach((I,B)=>{const P=h.getKeyProps()[B].line*10;a=Math.max(a,P+20)}),h.modifiers.some(I=>I.category==="annotation")&&(a+=30)}),a}measureStaffTop(t,o){let a=0;const c=Object.keys(t.vfVoices||{});if(c.length===0)return a;const d=[];for(const f of c)d.push(...t.vfVoices[f]);return d.forEach(f=>{f.keys.forEach((h,M)=>{const B=f.getKeyProps()[M].line*10;a=Math.min(a,B-20)})}),a}createVoices(t){let o=4,a=4;if(t.timeSignature){const h=t.timeSignature.split("/");o=parseInt(h[0]),a=parseInt(h[1])}const c=[];let d=[];const f=Object.keys(t.vfVoices||{});for(const h of f){const M=t.vfVoices[h],I=new r.Voice({numBeats:o,beatValue:a});I.setStrict(!1),I.addTickables(M),c.push(I),d.push(...M)}return{voices:c,allNotes:d}}}class yt{static async MXLtoXML(t){const o=new nt;try{const a=await o.loadAsync(t),c=Object.keys(a.files);let d="META-INF/container.xml",f=c.find(h=>h.endsWith(".xml")&&!h.includes("container.xml")&&!h.startsWith("__MACOSX"));if(f||(f=c.find(h=>h.endsWith(".musicxml")&&!h.startsWith("__MACOSX"))),f)return await a.file(f)?.async("string")||"";throw new Error("No MusicXML file found in MXL.")}catch(a){throw console.error(a),new Error("Failed to parse MXL file.")}}}class Nt{constructor(t){this.container=t,getComputedStyle(this.container).position==="static"&&(this.container.style.position="relative"),this.cursorElement=document.createElement("div"),this.cursorElement.style.position="absolute",this.cursorElement.style.zIndex="1000",this.cursorElement.style.backgroundColor="rgba(255, 0, 0, 0.5)",this.cursorElement.style.width="4px",this.cursorElement.style.pointerEvents="none",this.cursorElement.style.display="none",this.container.appendChild(this.cursorElement)}container;cursorElement;timestampMap=new Map;timestamps=[];currentIndex=0;get hidden(){return this.cursorElement.style.display==="none"}init(t){this.timestampMap=t,this.timestamps=Array.from(t.keys()).sort((o,a)=>o-a),this.currentIndex=0,this.hide()}show(){this.cursorElement.style.display="block",this.update()}hide(){this.cursorElement.style.display="none"}next(){this.currentIndex<this.timestamps.length-1&&(this.currentIndex++,this.update())}prev(){this.currentIndex>0&&(this.currentIndex--,this.update())}reset(){this.currentIndex=0,this.update()}update(){if(this.timestamps.length===0)return;const t=this.timestamps[this.currentIndex],o=this.timestampMap.get(t);if(o&&o.length>0){let a=o[0].y,c=o[0].y+o[0].height,d=o[0].x;o.forEach(f=>{a=Math.min(a,f.y),c=Math.max(c,f.y+f.height),d=Math.min(d,f.x)}),this.cursorElement.style.left=`${d}px`,this.cursorElement.style.top=`${a}px`,this.cursorElement.style.height=`${c-a}px`}}}class vt{constructor(t){if(typeof t=="string"){const o=document.getElementById(t);if(!o)throw new Error("Container element not found");this.container=o}else this.container=t;this.drawer=new st(this.container),this.cursor=new Nt(this.container)}container;drawer;sheet;graphicalSheet;cursor;async load(t){return new Promise(async(o,a)=>{try{let c="";typeof t=="string"?(t.startsWith("PK"),c=t):c=await yt.MXLtoXML(t),this.sheet=pt.readMusicXML(c),o()}catch(c){a(c)}})}render(){if(!this.sheet){console.warn("No sheet loaded. Call load() first.");return}this.graphicalSheet=new gt(this.sheet);const t=this.container.clientWidth||1e3,o=Q.format(this.graphicalSheet,t),a=this.drawer.draw(o);this.cursor.init(a),this.cursor.show()}}q.MusicSheet=tt,q.OpenSheetMusicDisplay=vt,q.VexFlowMusicSheetDrawer=st,Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})}));
